<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Five Nights: Custom & Golden Update</title>
    <style>
        body {
            background-color: #000;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            width: 1024px;
            height: 768px;
            background-color: #111;
            border: 4px solid #333;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            overflow: hidden;
        }

        /* --- MENUS --- */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #111;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .menu-options { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        
        /* Custom Night Sliders */
        .custom-row {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .ai-input {
            width: 60px;
            padding: 5px;
            background: #000;
            color: white;
            border: 1px solid #555;
            font-size: 20px;
            text-align: center;
        }

        /* --- OFFICE --- */
        #office-view {
            flex-grow: 1;
            background: #000;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: space-between;
            z-index: 5;
        }

        /* Golden Freddy Overlay */
        #golden-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Let clicks pass through */
            z-index: 20; /* On top of room, below camera */
            display: none;
            justify-content: center;
            align-items: center;
        }
        #golden-img {
            width: 60%;
            opacity: 0.9;
            filter: contrast(1.2) brightness(0.8);
        }

        .door-frame {
            width: 180px;
            height: 100%;
            background: #222;
            border-left: 5px solid #111;
            border-right: 5px solid #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .door-shutter {
            position: absolute;
            top: 0; width: 100%; height: 0%;
            background: repeating-linear-gradient(45deg, #333, #333 10px, #222 10px, #222 20px);
            transition: height 0.2s ease-in-out;
            z-index: 3;
            border-bottom: 5px solid #000;
        }
        .door-closed .door-shutter { height: 100%; }

        .hallway {
            width: 100%; height: 100%;
            background: #050505;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .window-enemy-img {
            width: 80%;
            height: auto;
            display: none; 
            z-index: 2;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
        }

        .room-bg {
            flex-grow: 1;
            background: radial-gradient(circle at center, #222 0%, #000 90%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 150px;
            color: #111;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
            z-index: 10;
        }

        button {
            padding: 15px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #555;
            background: #222;
            color: #fff;
            text-transform: uppercase;
            font-family: inherit;
        }
        button:active { background: #444; }
        .active { background: #fff !important; color: #000 !important; border-color: #fff !important; box-shadow: 0 0 15px #fff; }

        /* --- CAMERAS --- */
        #camera-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 50;
            display: none;
            flex-direction: column;
            border: 2px solid #555;
        }

        #cam-view {
            flex-grow: 1;
            position: relative;
            background: #050505;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Static effect overlay */
        #cam-view::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzj//v37zwjjgzhhYWGMIAIAiOMAmn7+HL4AAAAASUVORK5CYII=');
            opacity: 0.15;
            animation: grain 0.1s steps(10) infinite;
            pointer-events: none;
            z-index: 10;
        }

        .cam-img { max-width: 60%; max-height: 80%; object-fit: contain; filter: grayscale(80%) contrast(1.2); }

        #map {
            position: absolute;
            bottom: 20px; right: 20px;
            width: 250px; height: 200px;
            border: 2px solid #444;
            background: rgba(0,0,0,0.8);
            display: grid;
            grid-template-areas: "cam1a cam1a" "cam1b cam1c" "cam2a cam2b" "cam4a cam4b";
            gap: 5px; padding: 10px; z-index: 20;
        }
        
        .map-btn { background: #222; border: 1px solid #555; color: #888; font-size: 12px; padding: 5px; }
        .map-btn.selected { background: #4caf50; color: black; border-color: #0f0; }

        #camera-trigger {
            height: 40px; background: #333; color: #aaa;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; border-top: 2px solid #555; z-index: 60; font-size: 14px;
        }

        /* --- HUD --- */
        #hud {
            position: absolute; top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between;
            pointer-events: none; z-index: 60; text-shadow: 1px 1px 0 #000;
        }
        .stat { font-size: 24px; }
        .usage-bar { display: flex; gap: 5px; align-items: center; margin-top: 5px; }
        .usage-pip { width: 15px; height: 10px; background: #333; border: 1px solid #555; }
        .usage-pip.on { background: #4caf50; border-color: #0f0; }

        /* --- JUMPSCARES --- */
        #jumpscare-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 200;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        .scare-img { width: 50%; opacity: 0; object-fit: contain; }
        
        /* Standard Attack Animation */
        .anim-zoom { animation: zoomScare 0.4s ease-in forwards; }
        @keyframes zoomScare {
            0% { transform: scale(0.5) rotate(-5deg); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: scale(3.0) rotate(5deg); opacity: 1; }
        }

        /* Golden Freddy Attack Animation (Static Face) */
        .golden-kill-anim {
            width: 100% !important; height: 100% !important;
            opacity: 1 !important;
            animation: shake 0.1s infinite;
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen" class="overlay">
        <h1 style="font-size: 50px; text-shadow: 2px 2px red;">FIVE NIGHTS</h1>
        <div class="menu-options">
            <button onclick="startGame(false)">CONTINUE (Night <span id="menu-night-num">1</span>)</button>
            <button onclick="resetProgress()">NEW GAME</button>
            <button id="btn-custom" class="hidden" onclick="showCustomNight()">CUSTOM NIGHT</button>
        </div>
    </div>

    <div id="custom-menu" class="overlay hidden">
        <h1>CUSTOM NIGHT</h1>
        <p>Set AI Levels (0 - 20)</p>
        
        <div class="custom-row">
            <span style="color: #d32f2f; width: 100px;">RED:</span>
            <input type="number" id="ai-red" class="ai-input" min="0" max="20" value="0">
        </div>
        <div class="custom-row">
            <span style="color: #aaa; width: 100px;">SKULL:</span>
            <input type="number" id="ai-skull" class="ai-input" min="0" max="20" value="0">
        </div>
        <div class="custom-row">
            <span style="color: gold; width: 100px;">GOLD:</span>
            <input type="number" id="ai-gold" class="ai-input" min="0" max="20" value="0">
        </div>

        <button onclick="startGame(true)" style="margin-top: 20px;">START</button>
    </div>

    <div id="jumpscare-screen" class="hidden">
        <img id="scare-img" class="scare-img" src="" alt="Jumpscare">
    </div>

    <div id="game-over" class="overlay hidden">
        <h1 style="color: red; font-size: 60px;">GAME OVER</h1>
        <p id="death-msg" style="color: #666; font-size: 14px;"></p>
        <button onclick="location.reload()">MAIN MENU</button>
    </div>
    
    <div id="win-screen" class="overlay hidden">
        <h1 style="color: #4caf50; font-size: 60px;">6:00 AM</h1>
        <p>Night Complete.</p>
        <button onclick="location.reload()">NEXT</button>
    </div>

    <div id="hud">
        <div>
            <div class="stat" id="ui-time">12 AM</div>
            <div style="font-size: 12px; color: #888;" id="ui-night-display">Night 1</div>
        </div>
        <div style="text-align: right;">
            <div class="stat" id="ui-power">100%</div>
            <div class="usage-bar">
                <span style="font-size: 12px; margin-right: 5px;">USAGE:</span>
                <div class="usage-pip" id="pip1"></div>
                <div class="usage-pip" id="pip2"></div>
                <div class="usage-pip" id="pip3"></div>
                <div class="usage-pip" id="pip4"></div>
            </div>
        </div>
    </div>

    <div id="office-view">
        <div id="golden-overlay">
            <img id="golden-img" src="" alt="Golden Freddy">
        </div>

        <div class="door-frame">
            <div class="door-shutter" id="door-l"></div>
            <div class="hallway">
                <img id="enemy-window-left" class="window-enemy-img" src="" alt="Left Enemy">
            </div>
            <div class="controls">
                <button class="btn-door" id="btn-door-l" onclick="toggleDoor('left')">DOOR</button>
                <button class="btn-light" id="btn-light-l" onmousedown="toggleLight('left', true)" onmouseup="toggleLight('left', false)" onmouseleave="toggleLight('left', false)">LIGHT</button>
            </div>
        </div>

        <div class="room-bg">
            <span style="opacity: 0.1;">☢</span>
        </div>

        <div class="door-frame">
            <div class="door-shutter" id="door-r"></div>
            <div class="hallway">
                <img id="enemy-window-right" class="window-enemy-img" src="" alt="Right Enemy">
            </div>
            <div class="controls">
                <button class="btn-door" id="btn-door-r" onclick="toggleDoor('right')">DOOR</button>
                <button class="btn-light" id="btn-light-r" onmousedown="toggleLight('right', true)" onmouseup="toggleLight('right', false)" onmouseleave="toggleLight('right', false)">LIGHT</button>
            </div>
        </div>
    </div>

    <div id="camera-screen">
        <div style="padding: 10px 20px; background: #222; border-bottom: 1px solid #444; display: flex; justify-content: space-between;">
            <span style="color: red; animation: blink 1s infinite;">● REC</span>
            <span id="cam-name">CAM 1A</span>
        </div>
        <div id="cam-view">
            <div class="cam-content" id="cam-render"></div>
        </div>
        <div id="map">
            <button class="map-btn" style="grid-area: cam1a" onclick="switchCam('1A')">CAM 1A</button>
            <button class="map-btn" style="grid-area: cam1b" onclick="switchCam('1B')">CAM 1B</button>
            <button class="map-btn" style="grid-area: cam1c" onclick="switchCam('1C')">CAM 1C</button>
            <button class="map-btn" style="grid-area: cam2a" onclick="switchCam('2A')">CAM 2A</button>
            <button class="map-btn" style="grid-area: cam2b" onclick="switchCam('2B')">CAM 2B</button>
            <button class="map-btn" style="grid-area: cam4a" onclick="switchCam('4A')">CAM 4A</button>
            <button class="map-btn" style="grid-area: cam4b" onclick="switchCam('4B')">CAM 4B</button>
        </div>
    </div>

    <div id="camera-trigger" onclick="toggleCameraSystem()">
        <span style="letter-spacing: 2px;">[ MONITOR ]</span>
    </div>
</div>

<script>
    // ==========================================
    // === IMAGE LINKS ===
    // ==========================================
    const IMAGE_URLS = {
        // Red
        red_normal:  "BonnieCamera.png",
        red_window:  "BonnieDoor.png",
        red_jumpscare: "BonneJumpscare.png",

        // Skull
        skull_normal: "ChicaCamera.png",
        skull_window: "ChicaDoor.png",
        skull_jumpscare: "ChicaJumpscare.png",
        
        // Golden Freddy
        golden_office: "GoldenFreddyOffice.png", // Sitting in office
        golden_jumpscare: "GoldenJumpscare.png", // Full screen face
        
        // Power Outage
        power_jumpscare: "FreddyJumpscare.png"
    };

    // --- GAME CONSTANTS ---
    const TICK_RATE = 1000; 
    const NIGHT_LENGTH_MINUTES = 8; 
    const HOUR_TICKS = (NIGHT_LENGTH_MINUTES * 60) / 6; 
    
    // --- DIFFICULTY PRESETS (Red, Skull, Golden) ---
    // Levels are 0 to 20. 
    // Higher number = faster movement / higher chance.
    const NIGHT_DATA = {
        1: { red: 0, skull: 0, gold: 0 },       // Very Easy
        2: { red: 3, skull: 1, gold: 0 },       // Easy
        3: { red: 6, skull: 4, gold: 1 },       // Medium
        4: { red: 10, skull: 8, gold: 3 },      // Hard
        5: { red: 15, skull: 12, gold: 5 }      // Very Hard
    };

    // --- STATE ---
    let currentNight = parseInt(localStorage.getItem('fnaf_night')) || 1;
    let isCustomNight = false;

    // AI Levels (Set at start of night)
    let aiLevels = { red: 0, skull: 0, gold: 0 };

    let state = {
        playing: false,
        power: 100,
        timeTicks: 0,
        camerasOpen: false,
        currentCam: '1A',
        powerOutageTriggered: false,

        // Golden Freddy State
        goldenActive: false,
        goldenTimer: null,

        // Red
        leftDoor: false, leftLight: false, leftPos: 0, leftAttackTimer: 0,
        // Skull
        rightDoor: false, rightLight: false, rightPos: 0, rightAttackTimer: 0
    };

    let gameTimer;

    // --- INITIALIZATION ---
    window.onload = function() {
        document.getElementById('menu-night-num').innerText = currentNight;
        if (currentNight > 5) {
            document.getElementById('btn-custom').classList.remove('hidden');
            document.getElementById('menu-night-num').innerText = "COMPLETE";
        }
    };

    function showCustomNight() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('custom-menu').classList.remove('hidden');
    }

    function resetProgress() {
        localStorage.setItem('fnaf_night', 1);
        location.reload();
    }

    function startGame(custom) {
        // Setup Difficulty
        if (custom) {
            isCustomNight = true;
            aiLevels.red = parseInt(document.getElementById('ai-red').value);
            aiLevels.skull = parseInt(document.getElementById('ai-skull').value);
            aiLevels.gold = parseInt(document.getElementById('ai-gold').value);
        } else {
            isCustomNight = false;
            if (currentNight > 5) {
                // Default to Night 5 difficulty if replaying or just create Night 6
                aiLevels = { red: 18, skull: 18, gold: 8 }; 
            } else {
                aiLevels = NIGHT_DATA[currentNight];
            }
        }

        // UI Setup
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('custom-menu').classList.add('hidden');
        document.getElementById('ui-night-display').innerText = isCustomNight ? "Custom Night" : "Night " + currentNight;
        
        // Preload Images
        document.getElementById('enemy-window-left').src = IMAGE_URLS.red_window;
        document.getElementById('enemy-window-right').src = IMAGE_URLS.skull_window;
        document.getElementById('golden-img').src = IMAGE_URLS.golden_office;

        state.playing = true;
        gameTimer = setInterval(gameLoop, TICK_RATE);
        updateVisuals();
    }

    function gameLoop() {
        if (!state.playing) return;

        // 1. Time
        state.timeTicks++;
        let hour = 12 + Math.floor(state.timeTicks / HOUR_TICKS);
        if (hour > 12) hour -= 12;
        document.getElementById('ui-time').innerText = hour + " AM";
        
        if (Math.floor(state.timeTicks / HOUR_TICKS) === 6) {
            winGame();
            return;
        }

        // 2. Power
        let drain = 0.05; 
        if (state.leftDoor) drain += 0.15;
        if (state.rightDoor) drain += 0.15;
        if (state.leftLight) drain += 0.15;
        if (state.rightLight) drain += 0.15;
        if (state.camerasOpen) drain += 0.1;

        state.power -= drain;
        
        if (state.power <= 0) {
            state.power = 0;
            if (!state.powerOutageTriggered) {
                triggerPowerOutage();
            }
        }

        document.getElementById('ui-power').innerText = Math.floor(state.power) + "%";
        updateUsageMeter(drain);

        // 3. AI Logic
        handleAI();
    }

    function handleAI() {
        if (state.power <= 0) return; 

        // --- GOLDEN FREDDY LOGIC ---
        // Mechanics: Only appears when camera is DOWN.
        // Logic: Small chance every second to appear if AI level > 0 and not already active.
        if (aiLevels.gold > 0 && !state.camerasOpen && !state.goldenActive) {
            // Formula: 1 in (1000 / AI Level) chance per second roughly
            // Higher AI = Higher chance
            let chance = aiLevels.gold / 200; // e.g. Level 20 = 10% chance per second
            if (Math.random() < chance) {
                triggerGoldenFreddy();
            }
        }

        // --- RED LOGIC ---
        // Chance Check (AI Level 1-20 maps to roughly 5% to 80% movement chance every 4-5 seconds)
        // We simplify: Check every second, probability based on Level.
        // Level 20 = 20/20 chance? No, let's cap it. Level/40 per tick.
        if (state.leftPos < 4 && Math.random() < (aiLevels.red / 40)) {
            state.leftPos++;
            if(state.leftPos === 4) state.leftAttackTimer = 8; // Seconds before kill
        }
        if (state.leftPos === 4) {
            if (state.leftDoor) {
                if (Math.random() < 0.4) state.leftPos = 0; // Bonk door, go away
            } else {
                state.leftAttackTimer--;
                if (state.leftAttackTimer <= 0) jumpscare('RED');
            }
        }

        // --- SKULL LOGIC ---
        if (state.rightPos < 4 && Math.random() < (aiLevels.skull / 40)) {
            state.rightPos++;
            if(state.rightPos === 4) state.rightAttackTimer = 8;
        }
        if (state.rightPos === 4) {
            if (state.rightDoor) {
                if (Math.random() < 0.4) state.rightPos = 0; 
            } else {
                state.rightAttackTimer--;
                if (state.rightAttackTimer <= 0) jumpscare('SKULL');
            }
        }

        if (state.camerasOpen) renderCamera();
        updateVisuals();
    }

    function triggerGoldenFreddy() {
        state.goldenActive = true;
        const goldOverlay = document.getElementById('golden-overlay');
        goldOverlay.style.display = 'flex';
        
        // You have X seconds to put camera up
        // Harder difficulty = less time? Let's say flat 5 seconds for now.
        let reactionTime = Math.max(2, 6 - (aiLevels.gold / 5)); // Level 20 = 2 seconds

        state.goldenTimer = setTimeout(() => {
            if (state.goldenActive) {
                jumpscare('GOLD');
            }
        }, reactionTime * 1000);
    }

    function clearGoldenFreddy() {
        if (!state.goldenActive) return;
        
        state.goldenActive = false;
        clearTimeout(state.goldenTimer);
        document.getElementById('golden-overlay').style.display = 'none';
    }

    // --- INPUT HANDLERS ---
    function toggleDoor(side) {
        if (!state.playing || state.power <= 0) return;
        if (side === 'left') {
            state.leftDoor = !state.leftDoor;
            document.getElementById('door-l').parentElement.classList.toggle('door-closed', state.leftDoor);
            document.getElementById('btn-door-l').classList.toggle('active', state.leftDoor);
        } else {
            state.rightDoor = !state.rightDoor;
            document.getElementById('door-r').parentElement.classList.toggle('door-closed', state.rightDoor);
            document.getElementById('btn-door-r').classList.toggle('active', state.rightDoor);
        }
    }

    function toggleLight(side, on) {
        if (!state.playing || state.power <= 0) return;
        if (side === 'left') {
            state.leftLight = on;
            document.getElementById('btn-light-l').classList.toggle('active', on);
        } else {
            state.rightLight = on;
            document.getElementById('btn-light-r').classList.toggle('active', on);
        }
        updateVisuals();
    }

    function toggleCameraSystem() {
        if (!state.playing || state.power <= 0) return;
        
        // CORE MECHANIC: Toggle Camera
        state.camerasOpen = !state.camerasOpen;
        
        const camScreen = document.getElementById('camera-screen');
        const trigger = document.getElementById('camera-trigger');
        
        if (state.camerasOpen) {
            // OPEN CAMERA
            camScreen.style.display = 'flex';
            trigger.innerHTML = "[ CLOSE MONITOR ]";
            switchCam(state.currentCam);
            
            // GOLDEN FREDDY COUNTER: If he's there, opening camera clears him
            if (state.goldenActive) {
                clearGoldenFreddy();
            }

        } else {
            // CLOSE CAMERA
            camScreen.style.display = 'none';
            trigger.innerHTML = "[ MONITOR ]";
        }
    }

    function switchCam(camID) {
        state.currentCam = camID;
        document.getElementById('cam-name').innerText = "CAM " + camID;
        document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('selected'));
        document.querySelectorAll('.map-btn').forEach(b => { if(b.innerHTML.includes(camID)) b.classList.add('selected'); });
        renderCamera();
    }

    function renderCamera() {
        const view = document.getElementById('cam-render');
        view.innerHTML = "";
        let content = "";
        
        // Red Logic
        if (state.currentCam === '1A' && state.leftPos === 0) content = `<img class="cam-img" src="${IMAGE_URLS.red_normal}">`;
        if (state.currentCam === '1B' && state.leftPos === 1) content = `<img class="cam-img" src="${IMAGE_URLS.red_normal}">`;
        if (state.currentCam === '2A' && state.leftPos === 2) content = `<img class="cam-img" src="${IMAGE_URLS.red_normal}">`;
        if (state.currentCam === '4A' && state.leftPos === 3) content = `<img class="cam-img" src="${IMAGE_URLS.red_normal}">`;

        // Skull Logic
        if (state.currentCam === '1A' && state.rightPos === 0) content = `<img class="cam-img" src="${IMAGE_URLS.skull_normal}">`;
        if (state.currentCam === '1C' && state.rightPos === 1) content = `<img class="cam-img" src="${IMAGE_URLS.skull_normal}">`;
        if (state.currentCam === '2B' && state.rightPos === 2) content = `<img class="cam-img" src="${IMAGE_URLS.skull_normal}">`;
        if (state.currentCam === '4B' && state.rightPos === 3) content = `<img class="cam-img" src="${IMAGE_URLS.skull_normal}">`;

        // Both on Stage
        if (state.currentCam === '1A' && state.leftPos === 0 && state.rightPos === 0) {
            content = `<img class="cam-img" src="${IMAGE_URLS.red_normal}" style="margin-right:10px"><img class="cam-img" src="${IMAGE_URLS.skull_normal}">`;
        }

        if (content === "") content = "<span style='font-size:30px; color:#333'>(EMPTY)</span>";
        view.innerHTML = content;
    }

    function updateVisuals() {
        const elRed = document.getElementById('enemy-window-left');
        const elSkull = document.getElementById('enemy-window-right');

        if (state.leftPos === 4 && state.leftLight) elRed.style.display = 'block'; 
        else elRed.style.display = 'none';

        if (state.rightPos === 4 && state.rightLight) elSkull.style.display = 'block'; 
        else elSkull.style.display = 'none';
    }

    function updateUsageMeter(drain) {
        for(let i=1; i<=4; i++) document.getElementById('pip'+i).classList.remove('on');
        if (drain > 0.15) document.getElementById('pip1').classList.add('on');
        if (drain > 0.3) document.getElementById('pip2').classList.add('on');
        if (drain > 0.5) document.getElementById('pip3').classList.add('on');
        if (drain > 0.7) document.getElementById('pip4').classList.add('on');
    }

    function triggerPowerOutage() {
        state.powerOutageTriggered = true; 
        state.camerasOpen = false;
        document.getElementById('camera-screen').style.display = 'none';
        state.leftDoor = false; state.rightDoor = false;
        state.leftLight = false; state.rightLight = false;
        document.querySelector('.controls').style.display = 'none';
        document.getElementById('door-l').parentElement.classList.remove('door-closed');
        document.getElementById('door-r').parentElement.classList.remove('door-closed');
        
        document.getElementById('office-view').style.opacity = '0.3';
        
        // If Golden Freddy was active, clear him so normal death plays
        clearGoldenFreddy(); 

        setTimeout(() => jumpscare('POWER'), 5000);
    }

    function jumpscare(type) {
        state.playing = false;
        clearInterval(gameTimer);
        clearTimeout(state.goldenTimer);

        const jumpScreen = document.getElementById('jumpscare-screen');
        const jumpImg = document.getElementById('scare-img');
        
        document.getElementById('camera-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'none';

        // Set Images
        if (type === 'RED') jumpImg.src = IMAGE_URLS.red_jumpscare;
        else if (type === 'SKULL') jumpImg.src = IMAGE_URLS.skull_jumpscare;
        else if (type === 'POWER') jumpImg.src = IMAGE_URLS.power_jumpscare;
        else if (type === 'GOLD') jumpImg.src = IMAGE_URLS.golden_jumpscare;

        jumpScreen.classList.remove('hidden');

        // Golden Freddy has a different animation (Static Shake vs Zoom)
        if (type === 'GOLD') {
            jumpImg.classList.add('golden-kill-anim');
            // Play a crash sound or just freeze
        } else {
            jumpImg.classList.add('anim-zoom');
        }

        setTimeout(() => {
            jumpScreen.classList.add('hidden');
            document.getElementById('game-over').classList.remove('hidden');
            document.getElementById('death-msg').innerText = type === 'GOLD' ? "SYSTEM CRASH" : "CAUGHT BY " + type;
        }, type === 'GOLD' ? 2000 : 500); // Golden jumpscare lasts longer
    }

    function winGame() {
        state.playing = false;
        clearInterval(gameTimer);
        
        // Progress Logic
        if (!isCustomNight) {
            if (currentNight < 6) {
                currentNight++;
                localStorage.setItem('fnaf_night', currentNight);
            }
        }

        document.getElementById('win-screen').classList.remove('hidden');
    }
</script>
</body>
</html>
